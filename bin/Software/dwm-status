#!/bin/bash

MUSIC_STATE=true
TEMPDIR=/var/tmp/dwm-append/

if [[ ! -n $INETDEV ]]; then
	INETDEV=$(ifconfig | grep -m 1 -i "UP,BROADCAST,RUNNING,MULTICAST" | awk '{print $1;}' | sed -s "s/://g")
fi

function music_status {
	mpc | awk 'NR==2 {print $1}'
}

function music_name {
	mpc -f '%artist% - %title%' | sed -n 1p
}

function music_time {
	mpc | awk 'NR==2 {print $3}'
}

function music {
	if [[ $(mpc | awk 'NR==2 {print $1}') == "" ]]; then
		MUSIC_STATE=false
	fi

	if [[ $MUSIC_STATE == true ]]; then
		music_status
		printf " "
		music_name
		printf " ["
		music_time
		printf "]"
	else
		printf "[stopped]"
	fi
}

function utime {
	date +%H:%M:%S
}

function volume {
	printf "Volume: "
	amixer | awk 'NR==6 {print $5}'
}

function power {
	battery
}

function address {
	if [[ $(ifconfig $INETDEV | awk 'NR==2 {print $1}' ) == "inet" ]]; then
		printf "Connected: "
		ifconfig $INETDEV | awk 'NR==2 {print $2}'
	else
		printf "Not Connected"
	fi
}

function append {
	if [[ ! -d $TEMPDIR ]]; then
		mkdir $TEMPDIR
	fi

	cd $TEMPDIR

	for FILE in ./* ; do
		if [[ ! $FILE == "./*" ]]; then
			printf " | "
			cat $FILE
		fi
	done
}

for WIDGET in $DWM_WIDGET; do
	$WIDGET
	printf " | "
done | tr -d "\n" | cut -c 4- | rev | cut -c 4- | rev
