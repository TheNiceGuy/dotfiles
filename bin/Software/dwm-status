#!/bin/bash

MUSIC_STATE=true
TEMPDIR=/var/tmp/dwm-append/

if [[ ! -n $INETDEV ]]; then
	echo "Set the variable INETDEV"
	exit 1
fi

function music_status {
	mpc | awk 'NR==2 {print $1}'
}

function music_name {
	mpc -f '%artist% - %title%' | sed -n 1p
}

function music_time {
	mpc | awk 'NR==2 {print $3}'
}

function music {
	if [[ $(mpc | awk 'NR==2 {print $1}') == "" ]]; then
		MUSIC_STATE=false
	fi

	if [[ $MUSIC_STATE == true ]]; then
		music_status | tr -d '\n'
		printf " "
		music_name   | tr -d '\n'
		printf " ["
		music_time   | tr -d '\n'
		printf "]"
	else
		printf "[stopped]"
	fi
}

function utime {
	date +%H:%M:%S
}

function volume {
	printf "Volume: "
	amixer | awk 'NR==6 {print $5}' | tr -d '[]\n'
}

function power {
	battery | tr -d '\n'
}

function address {
	if [[ $(ifconfig $INETDEV | awk 'NR==2 {print $1}' ) == "inet" ]]; then
		printf "Connected: "
		ifconfig $INETDEV | awk 'NR==2 {print $2}' | tr -d '\n'
	else
		printf "Not Connected"
	fi
}

function append {
	if [[ ! -d $TEMPDIR ]]; then
		mkdir $TEMPDIR
	fi

	cd $TEMPDIR

	for FILE in ./* ; do
		if [[ ! $FILE == "./*" ]]; then
			cat $FILE | tr -d "\n"
			printf " | "
		fi
	done
}

append
address
printf " | "
volume
printf " | "
music
printf " | "
utime
